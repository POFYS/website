---
import Layout from '../../components/Layout.astro';

let _type: string | null = null;
if (Astro.url && Astro.url.searchParams && typeof Astro.url.searchParams.get === 'function') {
  _type = Astro.url.searchParams.get('type');
} else {
  try {
    const rawSearch = (Astro.url && (Astro.url.search || Astro.url.href || '')) || '';
    const query = rawSearch.includes('?') ? rawSearch.split('?').slice(1).join('?') : rawSearch;
    const params = new URLSearchParams(query);
    _type = params.get('type');
  } catch (e) {
    _type = null;
  }
}
const type = _type || 'article';
const key = (type === 'communique' || type === 'communiques') ? 'communique' : 'article';

const labels: Record<string, any> = {
  article: {
    title: 'المقال غير متوفر',
    description: 'هذا المقال غير متوفر باللغة المختارة بعد.',
    primary: 'العودة إلى المقالات الإنجليزية',
    secondary: 'تصفح المقالات العربية',
    primaryHref: '/articles',
    secondaryHref: '/ar/articles'
  },
  communique: {
    title: 'البيان غير متوفر',
    description: 'هذا البيان غير متوفر باللغة المختارة بعد.',
    primary: 'العودة إلى البيانات الإنجليزية',
    secondary: 'تصفح البيانات العربية',
    primaryHref: '/communiques',
    secondaryHref: '/ar/communiques'
  }
};

const current = labels[key];
---

<Layout title={current.title} description={current.description}>
  <div class="unavailable-page" lang="ar" dir="rtl">
    <header class="page-header">
      <h1>{current.title}</h1>
      <p>{current.description}</p>
    </header>

    <div class="actions">
      <a href={current.primaryHref} class="btn">{current.primary}</a>
      <a href={current.secondaryHref} class="btn secondary">{current.secondary}</a>
    </div>
  </div>
</Layout>

<style>
  .unavailable-page {
    max-width: 680px;
    margin: 4rem auto;
    text-align: center;
  }

  .page-header h1 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .page-header p {
    color: var(--color-text-secondary);
    margin-bottom: 1.5rem;
  }

  .actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 1.5rem;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-block;
    padding: 0.75rem 1.25rem;
    background: var(--color-accent);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 700;
  }

  .btn.secondary {
    background: transparent;
    color: var(--color-text-primary);
    border: 2px solid var(--color-border);
  }
</style>

<script type="module">
  try {
    const params = new URLSearchParams(window.location.search || '');
    const q = params.get('type');
    if (q === 'communique' || q === 'communiques') {
      const labels = {
        "title": "البيان غير متوفر",
        "description": "هذا البيان غير متوفر باللغة المختارة بعد.",
        "primary": "العودة إلى البيانات الإنجليزية",
        "secondary": "تصفح البيانات العربية",
        "primaryHref": "/communiques",
        "secondaryHref": "/ar/communiques"
      };
      const titleEl = document.querySelector('.unavailable-page .page-header h1');
      const descEl = document.querySelector('.unavailable-page .page-header p');
      const primaryBtn = document.querySelector('.unavailable-page .actions .btn');
      const secondaryBtn = document.querySelector('.unavailable-page .actions .btn.secondary');
      if (titleEl) titleEl.textContent = labels.title;
      if (descEl) descEl.textContent = labels.description;
      if (primaryBtn) { primaryBtn.textContent = labels.primary; primaryBtn.setAttribute('href', labels.primaryHref); }
      if (secondaryBtn) { secondaryBtn.textContent = labels.secondary; secondaryBtn.setAttribute('href', labels.secondaryHref); }
      document.title = labels.title;
    }
  } catch (e) {
    // ignore
  }
</script>
