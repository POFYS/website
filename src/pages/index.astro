---
import Layout from '../components/Layout.astro';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import { getArticles, convertStrapiArticle } from '../utils/strapi';
import { calculateReadingTime } from '../utils/reading-time';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

let sortedPosts: any[] = [];
try {
  const articlesResponse = await getArticles({
    sort: 'publishedAt:desc',
    pageSize: 3,
    locale: 'en'
  });
  
  sortedPosts = articlesResponse.data
    .map(convertStrapiArticle)
    .filter(article => article !== null)
    .map((article: any) => {
      const plainText = article.body
        .replace(/<[^>]*>/g, ' ')
        .replace(/\s+/g, ' ')
        .trim();
      return {
        ...article,
        readingTime: calculateReadingTime(plainText)
      };
    });
} catch (error) {
  console.error('Failed to fetch articles for home page:', error);
}
---

<Layout title={`${t('site.title')} | POFYS`} description={t('site.description')} showSidebar={false}>
  <div class="landing-page">
    <!-- Hero Section -->
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">Popular Organization of Free Yemeni Socialists</h1>
        <p class="hero-subtitle">POFYS</p>
        <p class="hero-description">
          Rising against corruption and foreign dependency to build a unified, independent, and just Yemen governed by and for its people.
        </p>
        <hr class="hero-rule" />
        <div class="hero-actions">
          <a href="#mission" class="btn btn-primary">Our Mission</a>
          <a href={`${import.meta.env.BASE_URL}articles`} class="btn btn-secondary">Read Our Articles</a>
        </div>
      </div>
    </section>

    <!-- Mission Section -->
    <section class="demo-section" id="mission">
      <div class="container">
        <h2 class="section-title">Our Mission</h2>
        <p class="demo-description">
          POFYS is dedicated to restoring Yemen's sovereignty to its people through justice, unity, and anti-corruption measures. 
          We reject all forms of foreign dependency and internal corruption that have betrayed our nation's dignity and independence.
        </p>
        
        {sortedPosts.length > 0 && (
          <div>
            <h3 style="text-align: center; font-family: var(--font-heading-secondary); font-size: 1.75rem; margin-bottom: calc(var(--grid-unit) * 4); color: var(--color-text-primary);">Latest Articles</h3>
            <div class="demo-posts">
              {sortedPosts.map(post => (
                <article class="demo-post-card">
                  <h3 class="demo-post-title">
                    <a href={`${import.meta.env.BASE_URL}articles/${post.slug}`}>{post.title}</a>
                  </h3>
                  
                        <div class="demo-post-meta">
                          <div class="meta-left">
                            {post.date && (
                              <time class="demo-post-date" datetime={new Date(post.date).toISOString()}>
                                {new Date(post.date).toLocaleDateString('en-GB', {
                                  year: 'numeric',
                                  month: 'long',
                                  day: 'numeric'
                                })}
                              </time>
                            )}

                            {post.author && (
                              <span class="post-author">by {post.author}</span>
                            )}
                          </div>

                          <div class="meta-right">
                            {post.readingTime && (
                              <span class="demo-post-reading-time">{post.readingTime}</span>
                            )}

                            {post.category?.slug && post.category?.name && (
                              <div class="demo-post-categories">
                                <a href={`${import.meta.env.BASE_URL}categories/${post.category.slug}`} class="demo-category">{post.category.name}</a>
                              </div>
                            )}
                          </div>
                        </div>
                  
                  {post.excerpt && (
                    <p class="demo-post-excerpt">{post.excerpt}</p>
                  )}
                  
                  {/* categories moved into meta-right */}
                </article>
              ))}
            </div>
          </div>
        )}
        
        <div class="demo-actions">
          <a href={`${import.meta.env.BASE_URL}articles`} class="btn btn-primary">Read All Articles</a>
        </div>
      </div>
    </section>

    <!-- Principles Section -->
    <section class="features" id="principles">
      <div class="container">
        <h2 class="section-title">Our Principles</h2>
        <div class="features-grid">
          <div class="feature-card">
            <h3 class="feature-title">National Sovereignty</h3>
            <p class="feature-description">Yemen's decision-making must belong to Yemenis alone, free from foreign capitals and external patrons who seek to control our destiny.</p>
          </div>
          <div class="feature-card">
            <h3 class="feature-title">Anti-Corruption</h3>
            <p class="feature-description">We fight against officials who have become executioners and thieves, transforming state resources into personal palaces while our people starve.</p>
          </div>
          <div class="feature-card">
            <h3 class="feature-title">Unity Against Division</h3>
            <p class="feature-description">Our strength lies in unity. We reject the fragmentation caused by corrupt factions that have torn our social fabric for their own gain.</p>
          </div>
          <div class="feature-card">
            <h3 class="feature-title">Rule of Law</h3>
            <p class="feature-description">Laws must apply equally to everyone, with no exceptions for wealth, status, or influence. Justice must be blind to privilege.</p>
          </div>
          <div class="feature-card">
            <h3 class="feature-title">People-Centered Governance</h3>
            <p class="feature-description">Institutions must serve the public, not private monopolies. Officials must be servants of the people, not masters over them.</p>
          </div>
          <div class="feature-card">
            <h3 class="feature-title">Youth & Inclusion</h3>
            <p class="feature-description">Merit-based leadership that promotes youth and women, rejects sectarianism and favoritism, and upholds human dignity as fundamental.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Context Section -->
    <section class="typography-showcase">
      <div class="container">
        <h2 class="section-title">Yemen's Struggle</h2>
        <p class="typography-description">
          Understanding the crisis of corruption and foreign dependency that has brought Yemen to its knees
        </p>
        
        <div class="context-content">
          <div class="context-block">
            <h3 class="context-title">High Treason Against the People</h3>
            <p class="context-text">
              We face not just administrative corruption, but high treason. The Houthis, Presidential Leadership Council, 
              Southern Transitional Council, and other factions are all partners in crime. They mortgage our national 
              decision-making to foreign capitals, receive money and weapons from abroad, and export death, poverty, 
              and hunger to us. They have sold Yemen's sovereignty for a low price.
            </p>
          </div>
          
          <div class="context-block">
            <h3 class="context-title">The Time of Silence is Over</h3>
            <p class="context-text">
              We will not accept being ruled by thieves, nor will we accept our decision being confiscated abroad. 
              These so-called leaders have proven they do not work for Yemen but act as agents for their financiers. 
              They fight over power but agree on looting the people. Their loyalty to foreign patrons has become 
              greater than their loyalty to the homeland and its citizens.
            </p>
          </div>
          
          <div class="context-block">
            <h3 class="context-title">A Call to Unity</h3>
            <p class="context-text">
              Our strength lies in our unity, and our weakness lies in our fragmentation behind corrupt parties that 
              have torn our social fabric. We call upon the free Yemeni people to reject division and stand together 
              against corruption and dependency. As God commanded: "Hold firmly to the rope of Allah all together 
              and do not become divided." Let hands unite to reclaim our Yemen from the hands of the corrupt.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Get Involved Section -->
    <section class="installation" id="get-involved">
      <div class="container">
        <h2 class="section-title">Join the Struggle</h2>
        <div class="install-steps">
          <div class="step">
            <h3 class="step-number">01</h3>
            <div class="step-content">
              <h4 class="step-title">Read & Understand</h4>
              <p class="step-description">
                Explore our analysis of corruption, foreign dependency, and the path forward for a free and 
                independent Yemen. Knowledge is the foundation of meaningful action.
              </p>
              <a href={`${import.meta.env.BASE_URL}articles`} class="btn btn-secondary" style="margin-top: calc(var(--grid-unit) * 2);">Browse Articles</a>
            </div>
          </div>
          
          <div class="step">
            <h3 class="step-number">02</h3>
            <div class="step-content">
              <h4 class="step-title">Connect & Organize</h4>
              <p class="step-description">
                Join the free Yemeni people in our popular struggle. Together we can build a new, unified, 
                independent, free, and just Yemeni state.
              </p>
              <a href={`${import.meta.env.BASE_URL}contact`} class="btn btn-secondary" style="margin-top: calc(var(--grid-unit) * 2);">Contact POFYS</a>
            </div>
          </div>
          
          <div class="step">
            <h3 class="step-number">03</h3>
            <div class="step-content">
              <h4 class="step-title">Stand Against Corruption</h4>
              <p class="step-description">
                Reject division and stand together against corruption and dependency. Our unity is our strength. 
                Long live Yemen, free, dignified, and independent.
              </p>
              <a href={`${import.meta.env.BASE_URL}about`} class="btn btn-secondary" style="margin-top: calc(var(--grid-unit) * 2);">Learn More</a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</Layout>

<style>
  .landing-page {
    width: 100%;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--content-padding);
  }

  .hero {
    text-align: center;
    padding: calc(var(--grid-unit) * 8) 0 calc(var(--grid-unit) * 8);
    background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-background) 100%);
  }

  .hero-content {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 var(--content-padding);
  }

  .hero-title {
    font-family: var(--font-heading-primary);
    font-size: 4.5rem;
    font-weight: 700;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    line-height: 0.9;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .hero-subtitle {
    font-family: var(--font-heading-secondary);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin-bottom: calc(var(--grid-unit) * 3);
  }

  .hero-description {
    font-size: 1.375rem;
    line-height: 1.6;
    color: var(--color-text-primary);
    margin-bottom: calc(var(--grid-unit) * 4);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .hero-rule {
    height: 6px;
    background-color: var(--color-accent);
    border: none;
    width: 150px;
    margin: 0 auto calc(var(--grid-unit) * 4);
  }

  .hero-actions {
    display: flex;
    gap: calc(var(--grid-unit) * 2);
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn {
    font-family: var(--font-heading-secondary);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: calc(var(--grid-unit) * 1.5) calc(var(--grid-unit) * 3);
    border-radius: 4px;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    font-size: 0.95rem;
  }

  .btn-primary {
    background-color: var(--color-accent);
    color: white;
    border: 2px solid var(--color-accent);
  }

  .btn-primary:hover,
  .btn-primary:focus {
    background-color: transparent;
    color: var(--color-accent);
    transform: translateY(-2px);
  }

  .btn-secondary {
    background-color: transparent;
    color: var(--color-text-primary);
    border: 2px solid var(--color-border);
  }

  .btn-secondary:hover,
  .btn-secondary:focus {
    background-color: var(--color-text-primary);
    color: var(--color-background);
    transform: translateY(-2px);
  }

  /* Dark mode button styles */
  :global([data-theme="dark"]) .btn-primary {
    background-color: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  :global([data-theme="dark"]) .btn-primary:hover,
  :global([data-theme="dark"]) .btn-primary:focus {
    background-color: transparent;
    color: var(--color-accent);
  }

  :global([data-theme="dark"]) .btn-secondary {
    background-color: transparent;
    color: var(--color-text-primary);
    border-color: var(--color-border);
  }

  :global([data-theme="dark"]) .btn-secondary:hover,
  :global([data-theme="dark"]) .btn-secondary:focus {
    background-color: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .features {
    padding: calc(var(--grid-unit) * 8) 0;
  }

  .section-title {
    font-family: var(--font-heading-secondary);
    font-size: 2.5rem;
    font-weight: 900;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: calc(var(--grid-unit) * 6);
    text-align: center;
  }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: calc(var(--grid-unit) * 4);
  }

  .feature-card {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: calc(var(--grid-unit) * 4);
    text-align: center;
    transition: transform 0.3s ease, border-color 0.3s ease;
  }

  .feature-card:hover {
    transform: translateY(-4px);
    border-color: var(--color-accent);
  }

  .feature-icon {
    font-size: 3rem;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .feature-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: calc(var(--grid-unit) * 1.5);
  }

  .feature-description {
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin: 0;
  }

  /* Typography Showcase */
  .typography-showcase {
    padding: calc(var(--grid-unit) * 8) 0;
    background-color: var(--color-surface);
  }

  .typography-description {
    text-align: center;
    font-size: 1.125rem;
    color: var(--color-text-secondary);
    margin-bottom: calc(var(--grid-unit) * 6);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .typography-samples {
    display: grid;
    gap: calc(var(--grid-unit) * 6);
  }

  .type-sample {
    text-align: center;
    padding: calc(var(--grid-unit) * 4);
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 8px;
  }

  .sample-h1 {
    font-family: var(--font-heading-primary);
    font-size: 3.5rem;
    font-weight: 700;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.15em;
    line-height: 1.1;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .sample-h2 {
    font-family: var(--font-heading-secondary);
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    line-height: 1.2;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .sample-body {
    font-family: var(--font-body);
    font-size: 1.125rem;
    line-height: 1.6;
    color: var(--color-text-primary);
    margin-bottom: calc(var(--grid-unit) * 2);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .sample-code {
    font-family: var(--font-mono);
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    padding: calc(var(--grid-unit)) calc(var(--grid-unit) * 1.5);
    border-radius: 4px;
    display: inline-block;
    margin-bottom: calc(var(--grid-unit) * 2);
    color: var(--color-text-primary);
  }

  .type-meta {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin: 0;
  }

  .demo-section {
    padding: calc(var(--grid-unit) * 8) 0;
  }

  .demo-description {
    text-align: center;
    font-size: 1.125rem;
    line-height: 1.6;
    color: var(--color-text-secondary);
    margin-bottom: calc(var(--grid-unit) * 6);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .demo-posts {
    display: grid;
    gap: calc(var(--grid-unit) * 4);
    margin-bottom: calc(var(--grid-unit) * 6);
  }

  .demo-post-card {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: calc(var(--grid-unit) * 3);
    transition: transform 0.2s ease, border-color 0.2s ease;
  }

  .demo-post-card:hover {
    transform: translateY(-2px);
    border-color: var(--color-accent);
  }

  .demo-post-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: calc(var(--grid-unit));
  }

  .demo-post-title a {
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .demo-post-title a:hover,
  .demo-post-title a:focus {
    color: var(--color-accent);
  }

  .demo-post-meta {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    gap: calc(var(--grid-unit));
    margin-bottom: calc(var(--grid-unit) * 1.5);
    flex-wrap: wrap;
  }

  .meta-left,
  .meta-right {
    display: flex;
    align-items: center;
    gap: calc(var(--grid-unit));
  }

  .demo-post-date {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .demo-post-reading-time {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  .demo-post-reading-time::after {
    content: "•";
    margin: 0 calc(var(--grid-unit) / 2);
    color: var(--color-border);
  }

  .post-author {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .post-author::before {
    content: "•";
    margin: 0 calc(var(--grid-unit) / 2);
    color: var(--color-border);
  }

  .demo-post-excerpt {
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .demo-post-categories {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--grid-unit) / 2);
  }

  .demo-category {
    background-color: var(--color-text-primary);
    color: white;
    padding: calc(var(--grid-unit) / 4) calc(var(--grid-unit) / 2);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 2px;
    transition: background-color 0.2s ease;
  }

  .demo-category:hover,
  .demo-category:focus {
    background-color: var(--color-accent);
    text-decoration: none;
  }

  /* Dark mode demo category styles */
  :global([data-theme="dark"]) .demo-category {
    background-color: var(--color-surface);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
  }

  :global([data-theme="dark"]) .demo-category:hover,
  :global([data-theme="dark"]) .demo-category:focus {
    background-color: var(--color-accent);
    color: white;
    border-color: var(--color-accent);
  }

  .demo-actions {
    text-align: center;
  }

  .installation {
    padding: calc(var(--grid-unit) * 8) 0;
    background-color: var(--color-surface);
  }

  .install-steps {
    display: grid;
    gap: calc(var(--grid-unit) * 4);
  }

  .step {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: calc(var(--grid-unit) * 2);
    align-items: start;
  }

  .step-number {
    font-family: var(--font-heading-primary);
    font-size: 3rem;
    font-weight: 900;
    color: var(--color-accent);
    margin: 0;
  }

  .step-content {
    display: flex;
    flex-direction: column;
  }

  .step-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: calc(var(--grid-unit));
  }

  .step-description {
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin: 0;
    font-size: 1rem;
  }

  .context-content {
    display: grid;
    gap: calc(var(--grid-unit) * 4);
  }

  .context-block {
    background-color: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: calc(var(--grid-unit) * 4);
  }

  .context-title {
    font-family: var(--font-heading-secondary);
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-accent);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: calc(var(--grid-unit) * 2);
  }

  .context-text {
    color: var(--color-text-primary);
    line-height: 1.8;
    margin: 0;
    font-size: 1.05rem;
  }

  @media (max-width: 768px) {
    .hero-title {
      font-size: 3rem;
    }

    .hero-subtitle {
      font-size: 1.25rem;
    }

    .hero-description {
      font-size: 1.125rem;
    }

    .hero-actions {
      flex-direction: column;
      align-items: center;
    }

    .features-grid {
      grid-template-columns: 1fr;
    }

    .step {
      grid-template-columns: 1fr;
      text-align: center;
    }

    .step-number {
      font-size: 2rem;
    }
  }

  @media (max-width: 480px) {
    .hero-title {
      font-size: 2rem;
    }

    .hero-subtitle {
      font-size: 1rem;
    }

    .hero-description {
      font-size: 1rem;
    }
  }
</style>